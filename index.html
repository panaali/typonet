<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="jquery.js"></script>
<title>Test</title>

<script>
var i = 0 ;
$(document).ready(function() {
	
	
	
	$('#input').focus();
	var sentence,
    words,
    chars = {};
    var newSentence = "";
	sentence = $('#sentence').text();
	sentenceChs = sentence.split("");
	word = sentence.split(" ");
    wrongChars = {wordID: 0, charID: 0};

	function splitter(sentence) {
	    words = sentence.split(" ");
	    
	    for (word in words) {
	        chars = words[word].split("");
	    }
	}
	
	
	var currentWord  = 0;
	var no = 0 ;
	var currentChar = 1;
	var wrongCount = 0;
	var wrongCountTotal = 0;
	function keypressing(){
		var wordAlt = sentence.split(" "); 		//startup green first word
		for(no in word){
			if(wordAlt[no] == wordAlt[currentWord]){
				wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
			} 
			newSentence += ' ' + wordAlt[no];
		}
		$('#sentence').html(newSentence);
		newSentence = "";
		
		$("#input").keyup(function(event){
			if ((event.which >= 65 && event.which <= 90) || (event.which >= 97 && event.which <= 122) || (event.which == 8) || (event.which == 32) ) { // 65-90 Lower Case , 97-122 Upper Case , 8 : backspace
				if(event.which == 8 && currentChar>=1) {	// pressed backspace
					currentChar--;
				}
				input = $('#input').val();
				wordchs = word[currentWord].split("");
				inputchs = input.split("");
				//console.log('$ :' + word[currentWord].slice(0,currentChar) + '% :' + input.slice(0,currentChar) + 'currentChar : ' + currentChar );
				if( word[currentWord].slice(0,currentChar) == input.slice(0,currentChar) ){
					socketTrueKey({key : input.charAt(currentChar) , currentWord : currentWord , currentChar : currentChar });
					$('#true').text('+');				// true key pressed
					var wordAlt = sentence.split(" "); ;
					for(no in word){
						if(wordAlt[no] == wordAlt[currentWord]){
							wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
						} 
						newSentence += ' ' + wordAlt[no];
					}
					$('#sentence').html(newSentence);
					newSentence = "";
					
					currentChar++;
				}else{
					socketFalseKey({key : input.charAt(currentChar) , currentWord : currentWord , currentChar : currentChar });
					$('#true').text('-');				// false key pressed
					wrongCount++;
					wrongCountTotal++;
					var wordAlt = sentence.split(" "); ;
					for(no in word){
						if(wordAlt[no] == wordAlt[currentWord]){
							wordAlt[no] = '<span style="color:red; font-size:130%;">' + wordAlt[no] + '</span>';
						} 
						newSentence += ' ' + wordAlt[no];
					}
					$('#sentence').html(newSentence);
					newSentence = "";
				}
				if(currentChar - 1 == word[currentWord].length ){
					if(event.which == 32){				// space pressed 
						socketEndWord({currentWord : currentWord , wrong : wrongCount });
						$('#true').text('***');			// This Word is Finished ! Let's Go Next
						$("#input").val('');
						$('#sentence').html(sentence);
						currentWord++ ;
						currentChar = 1;
						wrongCount = 0;
						
						var wordAlt = sentence.split(" "); 			// new word green			
						for(no in word){
							if(wordAlt[no] == wordAlt[currentWord]){
								wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
							} 
							newSentence += ' ' + wordAlt[no];
						}
						$('#sentence').html(newSentence);
						newSentence = "";
						
						
					}
					if(currentWord == word.length){		// Totally finished !!
						socketEndSentence();
						$('#true').text('*+*+*+*+*+*');			
						$('#accuracy').text('Your Accuracy is : ' + (1 - wrongCountTotal / sentenceChs.length )*100 );			
					}
				}
					
			}
		})
	};
	
	
	keypressing();
	function socketTrueKey(){};
	function socketFalseKey(){};
	function socketEndWord(){};
	function socketEndSentence(){};
})
</script>
</head>
<body>
<span></span>
<div id="sentence">salam Khoobi. Kojaii man inja hastam</div><br><br>
<input type="text" name="input" id="input"/>
</body>
<div id="accuracy"></div><br><br><br><br>
	<div id="true"></div>
</html>