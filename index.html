<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src="jquery.js"></script>
<title>Typonet</title>
<style>
#sentence{
	 direction: rtl;
	   font-size: 50px;
    margin: 200px auto 0px auto;
    text-align: center;
}
#input-box{
	   text-align: center;
		font-size: 30px;
}
input{
	font-size:30px;
}
#accuracy{
	color : blue ;
	text-align: center;
}
#wpm{
	color : blue ;
	text-align: center;
}
.round{
	 font-size: 40px;
		color:yellow;
}

.copywrite {
	text-align: center;
	margin-top : 100px;
}
.copywrite span{
	text-align: center;
	height : 200px;
}



</style>
<script>
var i = 0 ;
$(document).ready(function() {
	
	
	
	$('#input').focus();
	var sentence,
    words,
    chars = {};
    var newSentence = "";
	sentence = $('#sentence').text();
	sentenceChs = sentence.split("");
	word = sentence.split(" ");
    wrongChars = {wordID: 0, charID: 0};

	function splitter(sentence) {
	    words = sentence.split(" ");
	    
	    for (word in words) {
	        chars = words[word].split("");
	    }
	}
	
	
	var currentWord  = 0;
	var no = 0 ;
	var currentChar = 1;
	var wrongCount = 0;
	var wrongCountTotal = 0;
	var startTime =0
	function keypressing(){
		var wordAlt = sentence.split(" "); 		//startup green first word
		for(no in word){
			if(wordAlt[no] == wordAlt[currentWord]){
				wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
			} 
			newSentence += ' ' + wordAlt[no];
		}
		$('#sentence').html(newSentence);
		newSentence = "";
		
		$("#input").keyup(function(event){
			if(startTime == 0){
				startTime = new Date().getTime();
			}
			if ((event.which >= 65 && event.which <= 90) || (event.which >= 97 && event.which <= 122) || (event.which == 8) || (event.which == 32) ) { // 65-90 Lower Case , 97-122 Upper Case , 8 : backspace
				if(event.which == 8 && currentChar>=1) {	// pressed backspace
					currentChar--;
				}
				input = $('#input').val();
				wordchs = word[currentWord].split("");
				inputchs = input.split("");
				//console.log('$ :' + word[currentWord].slice(0,currentChar) + '% :' + input.slice(0,currentChar) + 'currentChar : ' + currentChar );
				if( word[currentWord].slice(0,currentChar) == input.slice(0,currentChar) ){
					socketTrueKey({key : input.charAt(currentChar) , currentWord : currentWord , currentChar : currentChar });
					//$('#true').text('+');				// true key pressed
					var wordAlt = sentence.split(" "); ;
					for(no in word){
						if(wordAlt[no] == wordAlt[currentWord]){
							wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
						} 
						newSentence += ' ' + wordAlt[no];
					}
					$('#sentence').html(newSentence);
					newSentence = "";
					
					currentChar++;
				}else{
					socketFalseKey({key : input.charAt(currentChar) , currentWord : currentWord , currentChar : currentChar });
					//$('#true').text('-');				// false key pressed
					wrongCount++;
					wrongCountTotal++;
					var wordAlt = sentence.split(" "); ;
					for(no in word){
						if(wordAlt[no] == wordAlt[currentWord]){
							wordAlt[no] = '<span style="color:red; font-size:130%;">' + wordAlt[no] + '</span>';
						} 
						newSentence += ' ' + wordAlt[no];
					}
					$('#sentence').html(newSentence);
					newSentence = "";
				}
				if(currentChar - 1 == word[currentWord].length ){
					if(event.which == 32){				// space pressed 
						socketEndWord({currentWord : currentWord , wrong : wrongCount });
						//$('#true').text('***');			// This Word is Finished ! Let's Go Next
						$("#input").val('');
						$('#sentence').html(sentence);
						currentWord++ ;
						currentChar = 1;
						wrongCount = 0;
						
						var wordAlt = sentence.split(" "); 			// new word green			
						for(no in word){
							if(wordAlt[no] == wordAlt[currentWord]){
								wordAlt[no] = '<span style="color:green; font-size:130%; ">' + wordAlt[no] + '</span>';
							} 
							newSentence += ' ' + wordAlt[no];
						}
						$('#sentence').html(newSentence);
						newSentence = "";
						
						
					}
					if(currentWord == word.length){		// Totally finished !!
						socketEndSentence({wrongCountTotal : wrongCountTotal});
						var endTime  = new Date().getTime();
						gameTime = ( endTime - startTime)/60000 ;
						//$('#true').text('*+*+*+*+*+*');			
						$('#accuracy').text('Accuracy : ' + Math.round(( 1 - wrongCountTotal / sentenceChs.length )*100)  + ' %' ); 			
						$('#wpm').text('WPM  : ' +  Math.round(word.length / gameTime)  );			
					}
				}
					
			}
		})
	};
	
	
	keypressing();
	function socketTrueKey(){};
	function socketFalseKey(){};
	function socketEndWord(){};
	function socketEndSentence(){};
})
</script>
</head>
<body>
<div id="sentence">منت خدای را عزوجل که طاعتش موجب قربت Mennat Khoday ra Azzavajal Ke taa'tash mojebe qorbat.</div><br><br>
<div id="input-box"><input type="text" name="input" id="input"/></div>
</body>
<br />
<div id="accuracy"></div>
<div id="wpm"></div><br><br>
	<div id="true"></div>
	<div class="copywrite"><span>Presented by : Soroush & Ali Akbar</span></div>
</html>